<!DOCTYPE html><html lang="en">
<head>
  <title>Cartogram</title>
  <style>
  svg { border: 1px solid #ccc; }
  path { stroke: #fff; }
  </style>
</head><body>

  <h1>Maps</h1>
  <svg class="plain" xmlns="http://www.w3.org/2000/svg" width="560" height="500"></svg>
  <svg class="carto" xmlns="http://www.w3.org/2000/svg" width="560" height="500"></svg>

  <!-- cartogram.js does not work with d3.v3 -->
  <script src="d3.v2.min.js"></script>
  <script src="topojson.v0.min.js"></script>
  <script src="cartogram.js"></script>
  <script>
  d3.json('S01_PC.topo.json', function(json) {
    var svg = d3.select('svg.plain');
    var object = d3.values(json.objects)[0];
    var shape = topojson.object(json, object);
    var bounds = d3.geo.bounds(shape);
    var projection = d3.geo.albers()
        .translate([parseInt(svg.attr('width'))/2, parseInt(svg.attr('height'))/2])
        .parallels([bounds[0][1], bounds[1][1]])
        .origin([(bounds[0][0] + bounds[1][0])/2, (bounds[0][1] + bounds[1][1])/2])
        .scale(3900);

    d3.select('svg.plain').selectAll('path')
        .data(shape.geometries)
      .enter().append('path')
        .attr('d', d3.geo.path().projection(projection))

    var svg = d3.select('svg.carto');
    var cartogram = d3.cartogram()
        .projection(projection)
        .value(function(d) {
            return Math.exp(1 + Math.random());
        });
    var paths = svg.selectAll('path')
        .data(cartogram(json, object.geometries).features);
    paths.enter().append('path')
        .attr('d', cartogram.path);
    setInterval(function() {
      paths.data(cartogram(json, object.geometries).features)
          .transition()
            .duration(500)
            .attr("d", cartogram.path);
    }, 2000)
  });
  </script>
</body></html>
